<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Juego de Parejas 2.0</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.rawgit.com/nnattawat/flip/master/dist/jquery.flip.min.js"></script>
    <style>
        body {
            background-image: url("images/background.jpg");
            background-size: cover;
            background-attachment: fixed;
        }

        @font-face {
            src: url(fonts/dienasty.ttf);
            font-family: "Witcher";
        }

        * {
            font-family: "Witcher", "Helvetica", sans-serif;
            font-weight: bold;
        }

        #blockcards {
            position:absolute;
            top:0;
            left:0;
            width:100%;
            height:100%;
            background-color: rgba(255, 255, 255, 0);
            z-index:900;
        }

        #logo, .carta {
            transition: all 0.3s;
        }

        #logo:hover , .carta:hover {
            -webkit-transform: scale(1.1);
            -moz-transform: scale(1.1);
            -o-transform: scale(1.1);
            transform: scale(1.1);
            /*transition: all 0.5s;*/
            /*-webkit-transition: all 0.5s;*/
        }

        div.carta {
            width: 12%; /*  7%   1:1,55 */
            height: 19.7%; /* 20% */
            float:left;
            margin-left: 2%;
            margin-top: 2%;
        }

        div.carta img{
            width:100%;
            height:100%;
        }

        .container h1, h2 {
            color: white;
        }

        span.red {
            color: #a72230;
        }

        #divDificultades button {
            color: black;
            background-color: white;
        }

        button.hard {
            color: white !important;
            background-color: #a72230 !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Juego de <span class="red">Parejas</span> 2.0</h1>
        <div id="blockcards" style="display: none;"></div>
        <div class="row" id="divDificultades">
            <h2>Elige el modo de dificultad:</h2>
            <div class="col-sm-offset-3" style="margin-left: 29%">
                <button class="btn dificultades" value="1">La historia y la espada (6x2)</button>
                <button class="btn hard dificultades" value="2">Sangre, sudor y lágrimas (6x3)</button>
            </div>
            <div class="col-sm-offset-3" style="margin-left: 32%; margin-top: 3%">
                <img src="images/main2.png" alt="Logo" width="400" height="300" id="logo">
            </div>
        </div>
        <div class="row" id="divCartas" style="margin-left: 20%; display: none;"></div>
    </div>
    <div class="bottom-bar" style="display: none;">
        <strong id="info">Información de la partida</strong>
        <span>Número de intentos: <span id="intentos" style="margin-left: 0">0</span></span>
        <span>Nº parejas acertadas: <span id="aciertos" style="margin-left: 0">0</span></span>
        <span>Cartas restantes: <span id="cartasRestantes" style="margin-left: 0">0</span></span>
        <button class="btn btn-danger" data-target="#modalReiniciar" data-toggle="modal" id="btnReiniciar">Iniciar nueva partida</button>
    </div>
    <div id="modalReiniciar" class="modal animated zoomIn" role="dialog" data-easein="expandIn">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h2 class="modal-title" id="h1Partida">Iniciar nueva partida</h2>
                </div>

                <div class="modal-body">
                    <p>Elige la dificultad. <strong>NOTA</strong>: Se perderá todo el progreso realizado.</p>
                    <div class="col-sm-offset-3">
                        <button class="btn btn-success dificultades" value="1">Fácil (6x2)</button>
                        <button class="btn btn-warning dificultades" value="2">Medio (6x3)</button>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" id="cerrar" class="btn btn-primary" data-dismiss="modal">Cerrar diálogo</button>
                </div>
            </div>
        </div>
    </div>
    <script>

        var arrayCartas = [], numCartasLev = 0, cartasLevantadas = [];

        $(document).ready(function () {
            $("button.dificultades").click(function () {
                $.get("getImages.php", { d: $(this).val() }, function (data) {
                    var json = JSON.parse(data);
                    //alert(json.imagenes[0].url);

                    var salida = "";
                    var aux = "";

                    arrayCartas = [];

                    for(var i = 0; i < json.imagenes.length; i++) {
                        aux = "<div class='carta' data-id='A" + json.imagenes[i].id + "' id='" + j + "' data-lev='N'><div class='front'><img src='images/back.jpg'/></div><div class='back'><img src='"+ json.imagenes[i].url +"'> </div></div>";

                        arrayCartas.push(aux);

                        j++;
                        aux = "<div class='carta' data-id='A" + json.imagenes[i].id + "' id='" + j + "' data-lev='N'><div class='front'><img src='images/back.jpg'/></div><div class='back'><img src='"+ json.imagenes[i].url +"'> </div></div>";

                        arrayCartas.push(aux);

                        j++;
                    }

                    shuffle(arrayCartas);

                    salida = "";
                    for(var j = 0; j < arrayCartas.length; j++) {

                        if(j == 0) {
                            salida += "<div class='row'>" + arrayCartas[j];
                        }

                        else if((j != 0) && (j%4==0) && (j!=(arrayCartas.length-1))) {
                            salida += "</div><div class='row'>" + arrayCartas[j];
                        }

                        else if(j == (arrayCartas.length-1)) {
                            salida += arrayCartas[j]+"</div>";
                        }
                        else {
                            salida += arrayCartas[j];
                        }
                    }

                    $("#divDificultades, #logo, .container h1").fadeOut();

                    $("#divCartas").html(salida).fadeIn();

                    $("div.carta").flip();

                    $("div.carta").on("click", function () {
                        var flip = $(this).data("flip-model");

                        if(flip.isFlipped == false) {
                            $(this).flip(true);
                        }

                        if(flip.isFlipped && $(this).attr('data-lev') != "S"){ // COMPRUEBA SI LA CARTA ESTA GIRADA
                            if(numCartasLev==0){
                                cartasLevantadas.push($(this));
                                numCartasLev++;
                            }
                            if(numCartasLev == 1){
                                if(cartasLevantadas[0].attr('id') != $(this).attr('id')){
                                    cartasLevantadas.push($(this));
                                    numCartasLev++;
                                }
                            }
                            if(numCartasLev == 2){
                                $("#blockcards").show();
                                if(cartasLevantadas[0].attr('data-id') != cartasLevantadas[1].attr('data-id')){
                                    var id1 = cartasLevantadas[0].attr('id').toString();
                                    var id2 = cartasLevantadas[1].attr('id').toString();

                                    setTimeout(function(){
                                        $("#"+id1).flip(false);
                                        $("#"+id2).flip(false);
                                    }, 600);
                                }
                                else{
                                    cartasLevantadas[0].attr('data-lev','S');
                                    cartasLevantadas[1].attr('data-lev','S');
                                }
                                setTimeout(function(){
                                    $("#blockcards").hide();
                                }, 600);
                                numCartasLev = 0;
                                cartasLevantadas = [];
                            }
                        }
                    });
                });
            });
        });

        function shuffle(a) {
            var j, x, i;
            for (i = a.length; i; i--) {
                j = Math.floor(Math.random() * i);
                x = a[i - 1];
                a[i - 1] = a[j];
                a[j] = x;
            }
        }
    </script>
</body>
</html>